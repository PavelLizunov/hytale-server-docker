services:
  hytale:
    build: .
    container_name: hytale
    restart: unless-stopped
    stdin_open: true
    tty: true
    volumes:
      - ${HYTALE_DATA_DIR:-/opt/hytale-data}:/data
    ports:
      - "${HYTALE_PORT:-5520}:5520/udp"
    environment:
      JAVA_OPTS: "${JAVA_OPTS:--Xms2G -Xmx6G}"
      HYTALE_BIND: "0.0.0.0:5520"
      BACKUP_ENABLED: "${BACKUP_ENABLED:-true}"
      BACKUP_FREQUENCY: "${BACKUP_FREQUENCY:-30}"

  updater:
    build: .
    container_name: hytale-updater
    profiles: ["manual"]
    volumes:
      - ${HYTALE_DATA_DIR:-/opt/hytale-data}:/data
    environment:
      PATCHLINE: "${PATCHLINE:-release}"
    entrypoint: ["/scripts/updater.sh"]

  auth-init:
    build: .
    container_name: hytale-auth
    profiles: ["manual"]
    volumes:
      - ${HYTALE_DATA_DIR:-/opt/hytale-data}:/data
    environment:
      TOKENS_DIR: /data/.tokens
    entrypoint: ["/scripts/auth-init.sh"]
